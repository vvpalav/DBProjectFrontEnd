<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Artist Home</title>

<!-- Style Sheets -->
<link rel="stylesheet" type="text/css" href="css/styles.css">
<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/plug-ins/9dcbecd42ad/integration/jqueryui/dataTables.jqueryui.css">
<link rel="stylesheet" type="text/css" href="//code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">

<!-- Java Script -->
<script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="//cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="//cdn.datatables.net/plug-ins/9dcbecd42ad/integration/jqueryui/dataTables.jqueryui.js"></script>

<script>

	var aname = window.location.search.replace("?", "").split("=")[1];
	
	function fetchArtistInfoAndConcertList(){
		var aname = window.location.search.replace("?", "").split("=")[1];
		var jsonStr = '{ "aname" : "' + aname + '", "type" : "fetchArtistInfoAndConcertList" }'
		xmlhttp = new XMLHttpRequest();
		xmlhttp.open("POST", "FetchDataFromDB", true);
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				var json = JSON.parse(xmlhttp.responseText);
				window.document.title = json.aname + " Home";
				document.getElementById("name").innerHTML = json.aname;
				document.getElementById("company").innerHTML = "Company: " + json.company;
				var p = json.webpage;
				if(p.lastIndexOf("/") == p.length-1){
					p = p.substring(0, p.length-1);
					p = p.replace("http://","");
					p = p.replace("https://","");
				}
				
				document.getElementById("webpage").innerHTML = p;
				var skills = json.skills;
				var str = "";
				for(var i = 0; i < skills.length; i++){
					str = str + " " + skills[i];
				}
				document.getElementById("skills").innerHTML = "Skills:" + str;
				updateDataSet(json.concertList);
			}
		};
		xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
		xmlhttp.send("json=" + jsonStr);
	}
	
	function updateDataSet(myVar){
		var dataSet = [];
		for (var i = 0; i < myVar.length; i++){
			var json = myVar[i];
			var ll = [];
			ll.push(json.concertId);
			ll.push(json.concertName);
			ll.push(json.link);
			ll.push(json.genre);
			ll.push(json.capacity);
			ll.push(json.price);
			ll.push(json.availableTickets);
			ll.push(json.venue);
			dataSet.push(ll);
		}
		$('#example').dataTable( {
            "data": dataSet,
            "columns": [
                { "width" : "10%", "title": "Concert Id", "class": "center" },
                { "width" : "11%", "title": "Concert Name", "class": "center" },
                { "width" : "15%", "title": "Webpage", "class": "center" },
                { "width" : "5%", "title": "Genre", "class": "center" },
                { "width" : "5%", "title": "Capacity", "class": "center" },
                { "width" : "5%", "title": "Price", "class": "center" },
                { "width" : "10%", "title": "Avail Tickets", "class": "center" },
                { "title": "Venue"}
            ]
        } );   	
	}

</script>
<style type="text/css">
label{
  text-align:center;
  color:#EEEEEE;
  font:17px Oswald;
}
</style>
</head>
<body onload="fetchArtistInfoAndConcertList()">
	<div id="artistInfo">
	 <h1 id="name"></h1><p/>
	 <label id="webpage"></label><br>
	 <label id="company"></label><br>
	 <label id="skills"></label><br>
	</div>
	<div id="concertsList">
	<h2>Concert List</h2><p/>
	<table class="display" id="example"></table>
	</div>
</body>
</html>